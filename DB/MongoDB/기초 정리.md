# 기초 정리

Created: 2021년 6월 24일
Created by: Seha Jyang

mongo db는 **대소문자를 구분한다**

## db 사이즈

한 db안의 인덱스와 컬렉션 개수가 26000개를 넘어설 수 없다. (16MB)

`--nssize` 로 조정가능

컬렉션과 인덱스를 위한 공간이 미리 할당되는데 이 사이즈는 64MB, 128MB

- 많은 데이터가 디스크에 연속적으로 저장되도록 미리 할당함

## 인덱스

- 기본적으로 **B-tree** 로 되어있다
- 한 컬렉션에 64개까지 인덱스를 만들 수 있다.
- 사용여부는 `explain()` 함수로 확인할 수 있다.

## 복제

- replica set
- 장애조치 및 읽기에 대한 확장을 위해서도 사용된다.
- 읽기위주 어플리케이션에선 복제 세트 클러스터 내의 여러 서버에 분산 할 수 있음
- 프라이머리 노드, 세컨더리 노드가 있으며 세컨더리 노드는 읽기만 가능
    - 프라이머리 노드에 장애가 발생하면 세컨더리 노드중 하나가 프라이머리로 승격

## 확장

- 범위기반(샤딩) 파티션 메커니즘을 통해 여러 노드에 분산하는걸 자동으로 관리해준다.
- 각각 샤드는 최소 두개의 노드로 구성된 복제세트로 이뤄져있음

## 동시성, 락

3.0은 컬렉션 레벨에서 도큐먼트 수준의 lock을 한다.

쓰기작업에 대한 최적화를 mongodb는, 쓰기 작업이 오래걸리는 경우 잠시 연산을 멈추고 다른 읽기/쓰기 연산을 하고 다시 작업을 재개한다(코루틴 테스크) 만약 이 연산을 하는 동안 다른 작업을 하길 원하지 않는다면 `$isolated` 옵션을 주면 된다. 이 옵션을 준 연산이 중간에 실패하면 암시적 롤백이 발생하지 않는다. 샤드된 컬렉션에선 작동하지 않는다.