# 49. 파라미터가 유효한지 검사하라

Created: 2021년 5월 19일
Created by: Seha Jyang

오류는 가능한 빨리 잡아야 한다. 오류가 발생한 즉시 잡지 못하면 해당 오류를 감지하기 어려워지고, 감지하더라도 오류의 발생 지점을 찾기 어려워진다.

`public` 과 `protected` 메서드는 파라미터 값이 잘못됐을 때 던지는 예외를 문서화 해야한다.

자바 7에 추가된 `Objects.requireNonNull` 메서드는 유연하고 사용하기도 편하니, 더이상 null검사를 수동으로 하지 않아도 된다. 또한 입력을 그대로 반환하므로 값을 사용하는 동시에 null검사를 수행할 수 있다.

```java
this.strategy = Objects.requireNonNull(strategy, "전략); 
```

자바 9에선 범위 검사 기능도 더해졌다. `checkFromIndexSize`, `chackFromToIndex` , `checkIndex` 인데 null검사 메서드만큼 유연하지는 않다.예외 메시지를 지정할 수 없고, 리스트와 배열 전용으로 설계됐다.또한 닫힌 범위는 다루지 못한다.

public이 아닌 메서드라면 `assert` 를 사용해 파라미터 유효성을 검증할 수 있다.

생성자 파라미터의 유효성 검사는 클래스 불변식을 어기는 객체가 만들어지지 않게 하는데 꼭 필요하다.

그러나 예외도 있다. 유효성 검사 비용이 지나치게 높거나 실용적이지 않을 때, 혹은 계산 과정에서 암묵적으로 검사가 수행될 때다.

예를들어 Collections.sort(List) 처럼 객체 리스트를 정렬하는 메서드의 아이템이 상호 비교될 수 있는지 검사해봐야 어차피 계산 과정에서 암묵적으로 검사가 수행되기 때문에 별다른 실익 없다.

하지만 암묵적 유효성 검사에 너무 의존했다가는 실패 원자성을 해칠 수 있으니 주의하자.

때로는 계산 과정에서 필요한 유효성 검사가 이뤄지지만 실패했을 때 잘못된 예외를 던지기도 한다.

계산 중 잘못된 파라미터 값을 사용해 발생한 예외와 API 문서에서 던지기로 한 예외가 다를 수 있다. 이럴땐 exception translate 관용구를 사용해 API문서에 기재된 예외로 번역해줘야 한다.

## 정리

메서드나 생성자를 작성할때면 그 파라미터들에 어떤 제약이 있을지 생각해야한다. 그 제약들을 문서화하고 메서드 코드 시작 부분에서 명시적으로 검사해야 한다. 이런 습관을 기르도록 하자. 그 노력은 유효성 검사가 실제 오류를 처음 걸러낼 때 충분히 보상받을 것이다.