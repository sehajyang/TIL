# 67. 최적화는 신중히 하라

Created: 2021년 5월 24일
Created by: Seha Jyang

모든 사람들이 새겨야 할 최적화 격언

맹목적인 어리석음을 포함해 그 어떤 핑계보다 효율성이라는 이름 아래 행해진 컴퓨팅 죄악이 더 많다 (심지어 효율을 높이지도 못하면서)

- 윌리엄 울프(Wulf72)

(전체의 97% 정도인) 자그마한 효율성은 모두 잊자. 섣부른 최적화가 만약의 근원이다. - 도널드 크누스(Knuth74)

최적화를 할 때는 다음 두 규칙을 따르라.

첫 번째, 하지마라.두 번째, (전문가 한정) 아직 하지 마라. 다시 말해, 완전히 명백하고 최적화되지 않은 해법을 찾을 때까지는 하지 마라.

- M.A 잭슨 (Jackson75)

**성능 때문에 견고한 구조를 희생하지 말자. 빠른 프로그램보다 좋은 프로그램을 작성하라**

좋은 프로그램은 개별 구성요소의 내부를 독립적으로 설계할 수 있다.따라서 시스템의 나머지에 영향을 주지 않고도 각 요소를 다시 설계할 수 있다.([item 15](15%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A2%E1%84%89%E1%85%B3%E1%84%8B%E1%85%AA%20%E1%84%86%E1%85%A6%E1%86%B7%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%8C%E1%85%A5%E1%86%B8%E1%84%80%E1%85%B3%E1%86%AB%20%E1%84%80%E1%85%AF%E1%86%AB%E1%84%92%E1%85%A1%E1%86%AB%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%8E%E1%85%AC%E1%84%89%E1%85%A9%E1%84%92%E1%85%AA%E1%84%92%E1%85%A1%E1%84%85%E1%85%A1%208de7ac3846de457c8a4499c1d26760a0.md))

구현상의 문제는 나중에 최적화해서 해결할 수 있지만 아키텍쳐의 결함이 성능을 제한한다면 시스템 전체를 다시 작성해야 할 수도 있다. 따라서 설계 단계에서 성능을 염두에 둬야한다.

**성능을 제한하는 설계를 피하라**

완성후 컴포넌트끼리, 외부 시스템과의 소통방식은 가장 변경하기 어렵다. API, 네트워크 프로토콜, 저장용 데이터 포멧등이 그러하다.

**API를 설계할 때 성능에 주는 영향을 고려하라**

public 타입을 가변으로 만들면 불필요한 방어적 복사를 수없이 유발할 수 있다[(item50)](50%20%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%89%E1%85%B5%E1%84%8B%E1%85%A6%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%E1%84%8C%E1%85%A5%E1%86%A8%20%E1%84%87%E1%85%A9%E1%86%A8%E1%84%89%E1%85%A1%E1%84%87%E1%85%A9%E1%86%AB%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%86%E1%85%A1%E1%86%AB%E1%84%83%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A1%2017634fabc79740f4aade532f059505cf.md)

상속도, 상위 클래스에 영원히 종속되므로 성능 제약까지 물려받게된다([item18](18%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A9%E1%86%A8%E1%84%87%E1%85%A9%E1%84%83%E1%85%A1%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%92%E1%85%A1%E1%86%B8%E1%84%89%E1%85%A5%E1%86%BC%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%84%85%E1%85%A1%2083b968b8c13f40c9bf9f139eae6adf07.md))

특정 구현체에 종속되게하면 안된다(**[item64](64%20%E1%84%80%E1%85%A2%E1%86%A8%E1%84%8E%E1%85%A6%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%B5%E1%86%AB%E1%84%90%E1%85%A5%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A2%20%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%E1%84%92%E1%85%A1%E1%84%85%E1%85%A1%20845aff4e70a44c9ca0e6f04ab83872dc.md)**)

**성능을 위해 API를 왜곡하는건 좋지 않다**

깨끗하고 명확한 프로그램을 완성한 다음에야 최적화를 고려해야 한다.

## 정리

빠른 프로그램을 작성하려 하지 말아야 한다. 좋은 프로그램을 작성하다보면 성능은 따라온다. 설계할때 API, 네트워크 프로토콜 저장용 데이터 포맷을 설계할 땐 성능을 염두에 둬야한다.

시스템 구현을 완료했다면 성능을 측정해보고 충분히 빠르다면 그것으로 끝이디. 그렇지않다면 프로파일러를 사용해 문제의 원인이 되는 지점을 찾아 최적화를 수행하라.