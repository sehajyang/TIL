# 85. 자바 직렬화의 대안을 찾으라

Created: 2021년 5월 29일
Created by: Seha Jyang

신뢰할 수 없는 바이트 스트림을 역직렬화 하는 일 자체가 스스로를 공격에 노출시키는 행위기 때문에 **직렬화 위험을 회피하는 가장 좋은 방법은 아무것도 역직렬화 하지 않는 것이다**

**작성하는 새로운 시스템에서 자바 직렬화를 써야 할 이유는 전혀 없다** 객체와 바이트 시퀀스를 변환해주는 다른 메커니즘이 많고 이런 메커니즘을 크로스-플랫폼 구조화된 데이터 표현(cross-platform structured-data reporesentation) 라 한다. 자바 직렬화보다 간단하고 분산 시스템을 구축하기에도 충분하고 자바 직렬화가 가져온 문제들을 회피할 수 있다. 대표적으론 JSON과 protobuf가 있다.

- JSON
    - 더글라스 크록퍼드가 브라우저-서버 통신용으로 설계
    - 사람이 읽을 수 있음
    - 데이터 표현에만 쓰임
    - 텍스트 기반으로 표현시 좋음
- protobuf
    - 구글이 만듦
    - 이진 표현이라 효율이 높다
    - 문서를 위한 스키마를 제공하고 올바로 쓰도록 강요함
    - 사람이 읽을 수 있는 형태도 제공(pbtxt)

레거시 시스템때문에 자바 직렬화를 배제하지 못할 경우 **신뢰할 수 없는 데이터는 역직렬화 하지 말아야 한다**

직렬화를 피할 수 없고 역직렬한 데이터가 안전한지 확신이 들지 않는다면 **객체 역직렬화 필터링(java.io.ObjectInputFilter)를 사용하자** 객체 역직렬화 필터링은 데이터 스트림이 역직렬화 되기 전에 필터를 설치하는 기능이다. 블랙리스트, 화이트 리스트 방식이 있으며 **블랙리스트보단 화이트 리스트방식이 좋다**

## 정리

직렬화는 위험하니 피해야하고 시스템을 밑바닥부터 설계한다면 JSON이나 프로토콜버퍼같은 대안을 사용하자. 신뢰할 수 없는 데이터는 역직렬화 하지 말아야하고 꼭 해야한다면 객체 역직렬화 필터링을 사용하되 이 마저도 모든 공격을 막아줄 순 없다. 클래스가 직렬화를 지원하도록 만들지 말고 꼭 그렇게 만들어야 한다면 정말 신경써서 작성해야 한다.