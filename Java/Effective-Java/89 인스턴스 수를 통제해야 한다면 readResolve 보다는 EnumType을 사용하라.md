# 89. 인스턴스 수를 통제해야 한다면 readResolve 보다는 EnumType을 사용하라

Created: 2021년 5월 29일
Created by: Seha Jyang

싱글톤인 클래스가 Serializable 을 구현하는 순간 더이상 싱글톤이 아니게 된다. 어떤 readObject를 사용하든 이 클래스가 초기화될 때 만들어진 인스턴스와는 별개인 인스턴스를 리턴하게 된다.

`readResolve` 메서드를 적절히 정의해뒀다면 역직렬화 후 새로 생성된 객체를 파라미터로 이 메서드가 호출되고 이 메서드가 리턴한 객체 참조가 새로 생성된 객체를 대신해 리턴된다. **사실 readResolve 를 인스턴스 통제 목적으로 사용한다면 객체 참조 타입 인스턴스 필드는 모두 transient로 선언해야 한다**

싱글톤이 transient가 아닌 참조 필드를 갖고있다면 그 필드의 내용은 readResolve메서드가 실행되기 전에 역직렬화 된다.

## 정리

불변식을 지키기위해 인스턴스를 통제해야 한다면 가능한 enumtype을 사용하자 여의치 않은 상황에서 직렬화와 인스턴스 통제가 모두 필요하다면 readResolve 메서드를 작성해 넣어야 하고 그 클래스에서 모든 참조 타입 인스턴스 필드를 transient로 선언해야 한다.