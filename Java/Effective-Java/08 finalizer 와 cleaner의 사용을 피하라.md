# 8. finalizer 와 cleaner의 사용을 피하라.

Created: 2021년 3월 21일
Created by: Seha Jyang

- 자바는 두가지 객체 소멸자를 제공한다.
    - finalizer
        - finalizer 는 예측할 수 없고 상황에 따라 위험할 수 있어 보통 불필요함.
    - cleaner
        - cleaner 는 finalizer 만큼은 아니지만 예측할 수 없고 느리고 보통 불필요하다.
- 이 객체 소멸자들은 제때 실행되어야 하는 작업을 절대 할 수 없다. 느리기 때문.
    - 수행은 전적으로 gc알고리즘에 달렸으며 gc 구현마다 천차만별이다.
- **상태를 영구적으로 수정하는 작업에선 절대 finalizer나 cleaner에 의존해선 안**된다.
    - 수행 시점 뿐 아니라 수행 여부조차 보장하지 않기 때문
    - lock 해제를 맡겨두면 시스템 전체가 서서히 멈출 것이다.
- 심각한 성능 문제도 있다.
    - try with resources 로 리소스 해제하는 시간보다 50배 느림
- finalizer를 사용한 클래스는 공격에 노출되어 보안문제를 일으킬 수도 있다.
    - 객체 생성을 막으려면 생성자에서 예외를 던지는 것만으로 충분하지만 finalizer가 있다면 그렇지도 않다.
    - final 이 아닌 클래스를 finalizer 공격으로부터 방어하려면 아무일도 하지 않는 finalize 메서드를 만들고 final 로 선언하자.

## 대안

- **AutoCloseable 을 구현해주고 클라이언트에서 인스턴스를 다 쓰고나면 close를 호출하도록 하자(혹은 try with resource 를 사용하자)**

### 결론

- cleaner 는 안정망 역할이나 중요하지 않는 네이티브 자원 회수 용으로만 사용하자. 그리고 불확실성과 성능저하에 주의해야한다.