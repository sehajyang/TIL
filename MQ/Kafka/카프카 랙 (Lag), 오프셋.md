# 카프카 랙 (Lag), 오프셋

Created: 2021년 7월 3일
Created by: Seha Jyang

## 카프카 랙

카프카 렉으로 프로듀서와 컨슈머간의 상태에 대해 모니터링 할 수 있다.

프로듀서가 데이터 넣는 속도가 컨슈머가 소비하는 속도보다 높을때 발생.

- 가장 최신 오프셋과 컨슈머 오프셋과의 차이
    - `프로듀서가 넣은 최신 데이터 오프셋 - 컨슈머가 읽은 오프셋`
- 한 토픽에 여러 파티션이 존재하는 경우
    - lag 은 여러개가 존재할 수 있다.
    - 그 중 가장 높은 숫자의 lag은 `record-lag-max` 라고 한다.

구현한 컨슈머 객체를 통해 lag 정보를 가져올 수 있지만 위험하다.

- 컨슈머 상태에 디펜던시가 걸리기 때문
    - 컨슈머 죽으면 lag 정보를 보낼 수 없기 때문에 lag정보를 알 수 없다.
    - 컨슈머가 개발될 때 마다 lag 전송하는 로직도 개발해야 된다.

⇒ borrow 추천

### borrow

linkedin에서 개발한 카프카 랙 모니터링 오픈소스

- 멀티 카프카 클러스터 지원
- sliding window를 통한 카프카 상태 확인
- HTTP API 제공

## 카프카 오프셋

파티션에 들어간 데이터에 붙는 숫자.

토픽별로 파티션별로 별개로 지정(GUID 아님, 파티션 내에서만 고유함)