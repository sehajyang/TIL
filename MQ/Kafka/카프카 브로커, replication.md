# 카프카 브로커, replication

Created: 2021년 7월 3일
Created by: Seha Jyang

## 카프카 브로커

- 카프카가 설치되어있는 서버 단위
- 일반적으론 3개 이상으로 구성

## Replication

- 브로커간의 파티션의 복제
- 브로커 3대라고 가정할 시 갯수 설정에 따른 파티션 복제 상태는 다음과 같다.
    - 1 ⇒ 파티션은 여러 브로커중 1개의 브로커 내에만 존재
    - 2 ⇒ 원본 파티션1, 복제 파티션 1
    - 3 ⇒ 원본1, 복제2로 총 3개의 파티션이 존재
- 브로커 갯수에 따라 replication 갯수가 제한된다.
    - 브로커 갯수 ≥ replication 갯수
    - replication 갯수가 너무 많아지면 브로커 사용량도 늘어난다.
    - retention date(저장시간) 고려해서 잘 정해야 함
    - 3개이상의 브로커 사용시 3 이상 추천
- 리더 파티션(원본 파티션)
    - 프로듀서가 토픽의 파티션에 데이터 전달할 때 전달받는 주체
    - 프로듀서의 `ACK`옵션으로 전달에 대한 응답 설정을 할 수 있으며 총 3개의 옵션이 있다.
        - 0 ⇒ 리더 파티션에 데이터 전송하고 응답 안받음, 속도는 빠르지만 데이터 전송 성공 여부를 알 수 없다.
        - 1 ⇒ 전송에 대한 응답값을 받지만 리더가 아닌 나머지 파티션에 복제됐는진 알 수 없음.
        - 2 ⇒ follower 파티션에 저장됐는지까지 확인한다.
            - 데이터 유실은 없지만 속도가 느리다.
- ISR (In Sync Replication)
    - 리더 파티션 + follower 파티션